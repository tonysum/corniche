version: '3.8'

services:
  data-service:
    build:
      context: ./backend
      dockerfile: Dockerfile.backend
    container_name: data-service
    ports:
      - "8001:8001"
    volumes:
      - ./data:/app/data
      - ./data/backtrade_records:/app/backtrade_records
    environment:
      - DATA_SERVICE_PORT=8001
      - DB_PATH=/app/data/crypto_data.db
    working_dir: /app
    command: python services/data_service/main.py
    restart: unless-stopped
    networks:
      - crypto-network

  backtest-service:
    build:
      context: ./backend
      dockerfile: Dockerfile.backend
    container_name: backtest-service
    ports:
      - "8002:8002"
    volumes:
      - ./data:/app/data
      - ./data/backtrade_records:/app/backtrade_records
    environment:
      - BACKTEST_SERVICE_PORT=8002
      - DB_PATH=/app/data/crypto_data.db
    working_dir: /app
    command: python services/backtest_service/main.py
    restart: unless-stopped
    networks:
      - crypto-network

  order-service:
    build:
      context: ./backend
      dockerfile: Dockerfile.backend
    container_name: order-service
    ports:
      - "8003:8003"
    volumes:
      - ./data:/app/data
    environment:
      - ORDER_SERVICE_PORT=8003
      - DB_PATH=/app/data/crypto_data.db
    working_dir: /app
    command: python services/order_service/main.py
    restart: unless-stopped
    networks:
      - crypto-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_DATA_SERVICE_URL=http://localhost:8001
      - NEXT_PUBLIC_BACKTEST_SERVICE_URL=http://localhost:8002
      - NEXT_PUBLIC_ORDER_SERVICE_URL=http://localhost:8003
    depends_on:
      - data-service
      - backtest-service
      - order-service
    restart: unless-stopped
    networks:
      - crypto-network

networks:
  crypto-network:
    driver: bridge

