# 故障排查指南

## "请求失败: Failed to fetch" 错误

### 可能原因和解决方案

#### 1. 后端服务未启动

**检查方法：**
```bash
# 检查8000端口是否被占用
lsof -i :8000

# 或者访问后端API文档
curl http://localhost:8000/
```

**解决方案：**
```bash
# 启动后端服务
cd /Users/tony/Documents/crypto/top2
uvicorn api_server:app --host 0.0.0.0 --port 8000
```

#### 2. CORS跨域问题

**已解决：** 已在 `api_server.py` 中添加CORS中间件配置。

如果仍然有问题，检查：
- 后端服务是否已重启（修改代码后需要重启）
- 前端访问的URL是否在允许的origins列表中

#### 3. API地址配置错误

**检查方法：**
```bash
# 查看前端环境变量配置
cat frontend/.env.local
```

**解决方案：**
确保 `.env.local` 文件中的 `NEXT_PUBLIC_API_URL` 指向正确的后端地址：
```
NEXT_PUBLIC_API_URL=http://localhost:8000
```

如果后端运行在其他地址或端口，请相应修改。

#### 4. 网络连接问题

**检查方法：**
```bash
# 测试后端连接
curl http://localhost:8000/api/health
```

**解决方案：**
- 确保防火墙没有阻止连接
- 检查是否有代理设置影响连接

#### 5. 前端开发服务器未启动

**检查方法：**
访问 http://localhost:3000 看是否能打开页面

**解决方案：**
```bash
cd frontend
npm run dev
```

## 完整启动流程

### 终端1 - 启动后端
```bash
cd /Users/tony/Documents/crypto/top2
uvicorn api_server:app --host 0.0.0.0 --port 8000
```

应该看到类似输出：
```
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

### 终端2 - 启动前端
```bash
cd /Users/tony/Documents/crypto/top2/frontend
npm run dev
```

应该看到类似输出：
```
  ▲ Next.js 16.1.1
  - Local:        http://localhost:3000
  - Ready in xxx ms
```

### 验证连接

1. 打开浏览器访问 http://localhost:3000
2. 打开浏览器开发者工具（F12）
3. 查看 Console 标签页是否有错误信息
4. 查看 Network 标签页，检查API请求是否成功

## 常见错误信息

### "无法连接到后端服务器"
- 后端服务未启动
- API地址配置错误
- 端口被占用

### "CORS policy: No 'Access-Control-Allow-Origin' header"
- CORS中间件未正确配置
- 后端服务需要重启

### "404 Not Found"
- API路径错误
- 后端路由未定义

### "500 Internal Server Error"
- 后端代码错误
- 查看后端终端输出的错误信息

## 调试技巧

1. **查看浏览器控制台**：F12 -> Console 标签页
2. **查看网络请求**：F12 -> Network 标签页
3. **查看后端日志**：检查运行 `uvicorn` 的终端输出
4. **测试API直接访问**：
   ```bash
   curl http://localhost:8000/api/health
   curl http://localhost:8000/api/symbols?interval=1d
   ```

