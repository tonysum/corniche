# æ•°æ®ç®¡ç†æ¨¡å—ç‹¬ç«‹é¡¹ç›®è¿ç§»æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•å°†æ•°æ®ç®¡ç†æ¨¡å—ä»å½“å‰é¡¹ç›®ç‹¬ç«‹å‡ºæ¥ï¼Œåˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„é¡¹ç›®ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨Pythonè„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
python scripts/create_data_manager_project.py

# æˆ–æŒ‡å®šç›®æ ‡ç›®å½•
python scripts/create_data_manager_project.py /path/to/crypto-data-manager
```

### æ–¹æ³•2: ä½¿ç”¨Shellè„šæœ¬

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./scripts/create_data_manager_project.sh

# æˆ–æŒ‡å®šç›®æ ‡ç›®å½•
./scripts/create_data_manager_project.sh /path/to/crypto-data-manager
```

### æ–¹æ³•3: æ‰‹åŠ¨è¿ç§»

æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®ã€‚

## ğŸ“ è¯¦ç»†æ­¥éª¤

### æ­¥éª¤1: åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„

```bash
mkdir -p crypto-data-manager/{backend,frontend/{app,components,contexts,lib},data,scripts,docs}
cd crypto-data-manager
```

### æ­¥éª¤2: å¤åˆ¶æ–‡ä»¶

#### åç«¯æ–‡ä»¶

```bash
# ä»åŸé¡¹ç›®å¤åˆ¶
cp ../corniche/backend/services/data_service/main.py backend/
cp ../corniche/backend/db.py backend/
cp ../corniche/backend/data.py backend/
cp ../corniche/backend/download_klines.py backend/
cp ../corniche/backend/binance_api.py backend/
cp ../corniche/backend/migrate.py backend/
cp ../corniche/backend/requirements.txt backend/
```

#### å‰ç«¯æ–‡ä»¶

```bash
# å¤åˆ¶æ•´ä¸ªå‰ç«¯ç›®å½•
cp -r ../corniche/frontend-data/* frontend/
```

### æ­¥éª¤3: åˆ›å»ºé…ç½®æ–‡ä»¶

#### `backend/config.py`

åˆ›å»º `backend/config.py` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```python
"""
æ•°æ®ç®¡ç†æœåŠ¡é…ç½®
"""
import os
from pathlib import Path
from dotenv import load_dotenv

# åŠ è½½ .env æ–‡ä»¶
backend_dir = Path(__file__).parent
project_root = backend_dir.parent
env_path = project_root / '.env'
if env_path.exists():
    load_dotenv(dotenv_path=env_path)

# æ•°æ®åº“é…ç½®
DB_PATH = os.getenv("DB_PATH", str(project_root / "data" / "crypto_data.db"))

# æœåŠ¡é…ç½®
SERVICE_PORT = int(os.getenv("DATA_SERVICE_PORT", "8001"))
SERVICE_HOST = os.getenv("DATA_SERVICE_HOST", "0.0.0.0")

# CORSé…ç½®
ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:3001",
    "http://127.0.0.1:3001",
]

# å¸å®‰APIé…ç½®
BINANCE_API_KEY = os.getenv("BINANCE_API_KEY", "")
BINANCE_API_SECRET = os.getenv("BINANCE_API_SECRET", "")
BINANCE_BASE_PATH = os.getenv("BINANCE_BASE_PATH", "")

# PostgreSQLé…ç½®ï¼ˆç”¨äºè¿ç§»ï¼‰
PG_HOST = os.getenv("PG_HOST", "localhost")
PG_PORT = int(os.getenv("PG_PORT", "5432"))
PG_DB = os.getenv("PG_DB", "crypto_data")
PG_USER = os.getenv("PG_USER", "postgres")
PG_PASSWORD = os.getenv("PG_PASSWORD", "")
```

### æ­¥éª¤4: ä¿®æ”¹å¯¼å…¥è·¯å¾„

#### `backend/main.py`

**ä¿®æ”¹å‰ï¼š**
```python
from services.shared.config import DATA_SERVICE_PORT, ALLOWED_ORIGINS
```

**ä¿®æ”¹åï¼š**
```python
from config import SERVICE_PORT as DATA_SERVICE_PORT, ALLOWED_ORIGINS
```

#### `backend/db.py`

**ä¿®æ”¹å‰ï¼š**
```python
# è·å–æ•°æ®åº“è·¯å¾„ï¼šä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œå¦åˆ™ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ data/crypto_data.db
db_path = os.getenv("DB_PATH")
if not db_path:
    # backendç›®å½•çš„çˆ¶ç›®å½•ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰ä¸‹çš„ data/crypto_data.db
    backend_dir = Path(__file__).parent
    project_root = backend_dir.parent
    db_path = str(project_root / "data" / "crypto_data.db")
```

**ä¿®æ”¹åï¼š**
```python
from config import DB_PATH as db_path
```

#### `backend/binance_api.py`

**ä¿®æ”¹å‰ï¼š**
```python
# ğŸ”§ åŠ è½½ .env æ–‡ä»¶
# ä»å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•å‘ä¸ŠæŸ¥æ‰¾ .env æ–‡ä»¶ï¼ˆæ”¯æŒ backend/ ç›®å½•å’Œé¡¹ç›®æ ¹ç›®å½•ï¼‰
backend_dir = Path(__file__).parent
project_root = backend_dir.parent
env_path = project_root / '.env'
if not env_path.exists():
    # å¦‚æœé¡¹ç›®æ ¹ç›®å½•æ²¡æœ‰ .envï¼Œå°è¯• backend ç›®å½•
    env_path = backend_dir / '.env'

if env_path.exists():
    load_dotenv(dotenv_path=env_path)
    logging.info(f"å·²åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶: {env_path}")
else:
    logging.warning(f"æœªæ‰¾åˆ° .env æ–‡ä»¶ï¼Œå°†ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é»˜è®¤å€¼ã€‚æŸ¥æ‰¾è·¯å¾„: {env_path}")
```

**ä¿®æ”¹åï¼š**
```python
from config import BINANCE_API_KEY, BINANCE_API_SECRET, BINANCE_BASE_PATH
# æ³¨æ„ï¼šå¦‚æœ binance_api.py éœ€è¦ç‹¬ç«‹åŠ è½½ .envï¼Œå¯ä»¥ä¿ç•™éƒ¨åˆ†ä»£ç 
```

#### `backend/migrate.py`

**ä¿®æ”¹å‰ï¼š**
```python
# ğŸ”§ åŠ è½½ .env æ–‡ä»¶ï¼ˆä¼˜å…ˆä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ï¼Œå…¶æ¬¡ backend ç›®å½•ï¼‰
backend_dir = Path(__file__).parent
project_root = backend_dir.parent
env_path = project_root / '.env'
if not env_path.exists():
    env_path = backend_dir / '.env'

if env_path.exists():
    load_dotenv(dotenv_path=env_path)
    logging.info(f"âœ… å·²åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶: {env_path}")
else:
    logging.warning(f"âš ï¸  æœªæ‰¾åˆ° .env æ–‡ä»¶ï¼Œå°†ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é»˜è®¤å€¼ã€‚æŸ¥æ‰¾è·¯å¾„: {project_root / '.env'}")
```

**ä¿®æ”¹åï¼š**
```python
from config import PG_HOST, PG_PORT, PG_DB, PG_USER, PG_PASSWORD
# æˆ–è€…ä¿ç•™åŸæœ‰çš„ .env åŠ è½½é€»è¾‘ï¼ˆå› ä¸º migrate.py å¯èƒ½éœ€è¦ç‹¬ç«‹è¿è¡Œï¼‰
```

### æ­¥éª¤5: åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

åˆ›å»º `.env.example`ï¼š

```env
# æ•°æ®åº“é…ç½®
DB_PATH=data/crypto_data.db

# æœåŠ¡é…ç½®
DATA_SERVICE_PORT=8001
DATA_SERVICE_HOST=0.0.0.0

# å¸å®‰APIé…ç½®
BINANCE_API_KEY=your_api_key_here
BINANCE_API_SECRET=your_api_secret_here
BINANCE_BASE_PATH=https://fapi.binance.com

# PostgreSQLé…ç½®ï¼ˆç”¨äºè¿ç§»ï¼‰
PG_HOST=localhost
PG_PORT=5432
PG_DB=crypto_data
PG_USER=postgres
PG_PASSWORD=your_password

# å‰ç«¯é…ç½®
NEXT_PUBLIC_API_URL=http://localhost:8001
```

å¤åˆ¶å¹¶ç¼–è¾‘ï¼š
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å®é™…é…ç½®
```

### æ­¥éª¤6: ä¿®æ”¹å‰ç«¯é…ç½®

#### `frontend/lib/api-config.ts`

ç¡®ä¿APIåŸºç¡€URLæ­£ç¡®ï¼š

```typescript
export const API_BASE_URL = 
  process.env.NEXT_PUBLIC_API_URL || 
  'http://localhost:8001';
```

### æ­¥éª¤7: æµ‹è¯•

#### æµ‹è¯•åç«¯

```bash
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python main.py
```

è®¿é—® http://localhost:8001/docs æŸ¥çœ‹APIæ–‡æ¡£ã€‚

#### æµ‹è¯•å‰ç«¯

```bash
cd frontend
npm install
npm run dev
```

è®¿é—® http://localhost:3001 æŸ¥çœ‹å‰ç«¯åº”ç”¨ã€‚

## ğŸ” éœ€è¦æ‰‹åŠ¨æ£€æŸ¥çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶å¯èƒ½éœ€è¦æ‰‹åŠ¨æ£€æŸ¥å’Œä¿®æ”¹ï¼š

1. **`backend/db.py`**
   - æ£€æŸ¥æ•°æ®åº“è·¯å¾„é…ç½®
   - ç¡®ä¿ä½¿ç”¨ `config.DB_PATH`

2. **`backend/binance_api.py`**
   - æ£€æŸ¥ç¯å¢ƒå˜é‡åŠ è½½é€»è¾‘
   - ç¡®ä¿APIå¯†é’¥é…ç½®æ­£ç¡®

3. **`backend/data.py`**
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä¾èµ–
   - ç¡®ä¿å¯¼å…¥è·¯å¾„æ­£ç¡®

4. **`backend/download_klines.py`**
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä¾èµ–
   - ç¡®ä¿å¯¼å…¥è·¯å¾„æ­£ç¡®

5. **`backend/migrate.py`**
   - æ£€æŸ¥PostgreSQLé…ç½®
   - ç¡®ä¿ç¯å¢ƒå˜é‡åŠ è½½æ­£ç¡®

6. **`frontend/components/*.tsx`**
   - æ£€æŸ¥APIè°ƒç”¨è·¯å¾„
   - ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„APIåŸºç¡€URL

## âœ… éªŒè¯æ¸…å•

- [ ] æ‰€æœ‰æ–‡ä»¶å·²å¤åˆ¶
- [ ] é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] å¯¼å…¥è·¯å¾„å·²ä¿®æ”¹
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] åç«¯æœåŠ¡å¯ä»¥å¯åŠ¨
- [ ] å‰ç«¯åº”ç”¨å¯ä»¥å¯åŠ¨
- [ ] APIæ–‡æ¡£å¯ä»¥è®¿é—®
- [ ] æ•°æ®ä¸‹è½½åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®å®Œæ•´æ€§æ£€æŸ¥æ­£å¸¸

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1: å¯¼å…¥é”™è¯¯

**é”™è¯¯ï¼š** `ModuleNotFoundError: No module named 'services.shared.config'`

**è§£å†³ï¼š** æ£€æŸ¥ `backend/main.py` ä¸­çš„å¯¼å…¥è·¯å¾„æ˜¯å¦å·²ä¿®æ”¹ä¸º `from config import`

### é—®é¢˜2: æ•°æ®åº“è·¯å¾„é”™è¯¯

**é”™è¯¯ï¼š** `SQLite æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨`

**è§£å†³ï¼š** æ£€æŸ¥ `backend/db.py` æ˜¯å¦ä½¿ç”¨ `from config import DB_PATH`

### é—®é¢˜3: ç¯å¢ƒå˜é‡æœªåŠ è½½

**é”™è¯¯ï¼š** APIå¯†é’¥æœªæ‰¾åˆ°

**è§£å†³ï¼š** 
1. ç¡®ä¿ `.env` æ–‡ä»¶å­˜åœ¨
2. æ£€æŸ¥ `backend/config.py` ä¸­çš„ `.env` åŠ è½½é€»è¾‘
3. ç¡®è®¤ç¯å¢ƒå˜é‡åç§°æ­£ç¡®

### é—®é¢˜4: CORSé”™è¯¯

**é”™è¯¯ï¼š** å‰ç«¯æ— æ³•è®¿é—®åç«¯API

**è§£å†³ï¼š** 
1. æ£€æŸ¥ `backend/config.py` ä¸­çš„ `ALLOWED_ORIGINS`
2. ç¡®ä¿å‰ç«¯URLåœ¨å…è®¸åˆ—è¡¨ä¸­

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®ç®¡ç†æ¨¡å—ç‹¬ç«‹é¡¹ç›®æ–¹æ¡ˆ.md](./æ•°æ®ç®¡ç†æ¨¡å—ç‹¬ç«‹é¡¹ç›®æ–¹æ¡ˆ.md) - å®Œæ•´çš„é¡¹ç›®æ–¹æ¡ˆ
- [APIæ–‡æ¡£](http://localhost:8001/docs) - APIæ¥å£æ–‡æ¡£ï¼ˆå¯åŠ¨åç«¯åè®¿é—®ï¼‰

## ğŸ”„ åç»­å·¥ä½œ

1. **ä»£ç ä¼˜åŒ–**
   - é‡æ„ä»£ç ç»“æ„
   - æ·»åŠ å•å…ƒæµ‹è¯•
   - æ·»åŠ é›†æˆæµ‹è¯•

2. **æ–‡æ¡£å®Œå–„**
   - ç¼–å†™APIæ–‡æ¡£
   - ç¼–å†™éƒ¨ç½²æ–‡æ¡£
   - ç¼–å†™å¼€å‘æ–‡æ¡£

3. **CI/CD**
   - é…ç½®GitHub Actions
   - é…ç½®è‡ªåŠ¨éƒ¨ç½²
   - é…ç½®ä»£ç æ£€æŸ¥

4. **ç›‘æ§å’Œæ—¥å¿—**
   - æ·»åŠ æ—¥å¿—ç³»ç»Ÿ
   - æ·»åŠ ç›‘æ§æŒ‡æ ‡
   - æ·»åŠ é”™è¯¯è¿½è¸ª
