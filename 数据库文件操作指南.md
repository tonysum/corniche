# æ•°æ®åº“æ–‡ä»¶ crypto_data.db æ“ä½œæŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä¸Šä¼ ã€å¤‡ä»½ã€è¿ç§»å’ŒåŒæ­¥ `crypto_data.db` æ•°æ®åº“æ–‡ä»¶ã€‚

## ğŸ“‹ ç›®å½•

1. [æ•°æ®åº“æ–‡ä»¶ä½ç½®](#æ•°æ®åº“æ–‡ä»¶ä½ç½®)
2. [ä¸Šä¼ åˆ°æœåŠ¡å™¨](#ä¸Šä¼ åˆ°æœåŠ¡å™¨)
3. [å¤‡ä»½æ•°æ®åº“](#å¤‡ä»½æ•°æ®åº“)
4. [è¿ç§»æ•°æ®åº“](#è¿ç§»æ•°æ®åº“)
5. [åŒæ­¥æ•°æ®åº“](#åŒæ­¥æ•°æ®åº“)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ•°æ®åº“æ–‡ä»¶ä½ç½®

### æœ¬åœ°ä½ç½®

```
é¡¹ç›®æ ¹ç›®å½•/
â””â”€â”€ data/
    â””â”€â”€ crypto_data.db  # ä¸»æ•°æ®åº“æ–‡ä»¶
```

### æœåŠ¡å™¨ä½ç½®ï¼ˆDocker éƒ¨ç½²ï¼‰

```
å®¹å™¨å†…: /app/data/crypto_data.db
ä¸»æœº:   ./data/crypto_data.db (ç›¸å¯¹äº docker-compose.yml)
```

### æœåŠ¡å™¨ä½ç½®ï¼ˆç›´æ¥éƒ¨ç½²ï¼‰

```
/opt/corniche/data/crypto_data.db
```

---

## ä¸Šä¼ åˆ°æœåŠ¡å™¨

### æ–¹æ³•1: ä½¿ç”¨ SCPï¼ˆæ¨èï¼‰

#### åŸºæœ¬å‘½ä»¤

```bash
# ä»æœ¬åœ°ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp data/crypto_data.db username@server-ip:/opt/corniche/data/

# ä½¿ç”¨å¯†é’¥æ–‡ä»¶
scp -i /path/to/key.pem data/crypto_data.db username@server-ip:/opt/corniche/data/

# ä¸Šä¼ æ•´ä¸ª data ç›®å½•
scp -r data/ username@server-ip:/opt/corniche/
```

#### å®Œæ•´ç¤ºä¾‹

```bash
# 1. åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
ssh username@server-ip "mkdir -p /opt/corniche/data"

# 2. ä¸Šä¼ æ•°æ®åº“æ–‡ä»¶
scp data/crypto_data.db username@server-ip:/opt/corniche/data/

# 3. è®¾ç½®æƒé™
ssh username@server-ip "chmod 644 /opt/corniche/data/crypto_data.db"
```

---

### æ–¹æ³•2: ä½¿ç”¨ rsyncï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰

```bash
# ä¸Šä¼ æ•°æ®åº“æ–‡ä»¶
rsync -avz --progress data/crypto_data.db username@server-ip:/opt/corniche/data/

# ä½¿ç”¨å¯†é’¥æ–‡ä»¶
rsync -avz --progress -e "ssh -i /path/to/key.pem" \
  data/crypto_data.db username@server-ip:/opt/corniche/data/

# ä¸Šä¼ æ•´ä¸ª data ç›®å½•
rsync -avz --progress data/ username@server-ip:/opt/corniche/data/
```

**ä¼˜ç‚¹ï¼š**
- âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ 
- âœ… åªä¼ è¾“å·®å¼‚éƒ¨åˆ†
- âœ… æ˜¾ç¤ºä¼ è¾“è¿›åº¦

---

### æ–¹æ³•3: ä½¿ç”¨ tar å‹ç¼©ä¸Šä¼ ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰

```bash
# 1. åœ¨æœ¬åœ°å‹ç¼©
cd data
tar czf crypto_data.db.tar.gz crypto_data.db

# 2. ä¸Šä¼ å‹ç¼©åŒ…
scp crypto_data.db.tar.gz username@server-ip:/tmp/

# 3. åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
ssh username@server-ip "cd /opt/corniche/data && tar xzf /tmp/crypto_data.db.tar.gz && rm /tmp/crypto_data.db.tar.gz"

# 4. æ¸…ç†æœ¬åœ°å‹ç¼©åŒ…
rm crypto_data.db.tar.gz
```

---

### æ–¹æ³•4: ä½¿ç”¨ Docker Volumeï¼ˆDocker éƒ¨ç½²ï¼‰

å¦‚æœä½¿ç”¨ Docker Composeï¼Œæ•°æ®åº“æ–‡ä»¶é€šè¿‡ volume æŒ‚è½½ï¼š

```bash
# 1. åœæ­¢æœåŠ¡
cd /opt/corniche
docker-compose down

# 2. ä¸Šä¼ æ•°æ®åº“æ–‡ä»¶åˆ°ä¸»æœº
scp data/crypto_data.db username@server-ip:/opt/corniche/data/

# 3. è®¾ç½®æƒé™
ssh username@server-ip "chmod 644 /opt/corniche/data/crypto_data.db"

# 4. å¯åŠ¨æœåŠ¡
docker-compose up -d
```

---

## å¤‡ä»½æ•°æ®åº“

### æ–¹æ³•1: ç®€å•å¤åˆ¶å¤‡ä»½

```bash
# æœ¬åœ°å¤‡ä»½
cp data/crypto_data.db data/crypto_data.db.backup.$(date +%Y%m%d_%H%M%S)

# æœåŠ¡å™¨å¤‡ä»½
ssh username@server-ip "cp /opt/corniche/data/crypto_data.db /opt/corniche/data/crypto_data.db.backup.$(date +%Y%m%d_%H%M%S)"
```

---

### æ–¹æ³•2: SQLite å¤‡ä»½å‘½ä»¤ï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨ SQLite çš„ .backup å‘½ä»¤ï¼ˆæ›´å®‰å…¨ï¼Œä¸ä¼šé”å®šæ•°æ®åº“ï¼‰
sqlite3 data/crypto_data.db ".backup 'data/crypto_data.db.backup.$(date +%Y%m%d_%H%M%S)'"

# åœ¨æœåŠ¡å™¨ä¸Šå¤‡ä»½
ssh username@server-ip "sqlite3 /opt/corniche/data/crypto_data.db \".backup '/opt/corniche/data/crypto_data.db.backup.$(date +%Y%m%d_%H%M%S)'\""
```

---

### æ–¹æ³•3: ä½¿ç”¨ Python è„šæœ¬å¤‡ä»½

åˆ›å»º `backup_db.py`:

```python
#!/usr/bin/env python3
"""
æ•°æ®åº“å¤‡ä»½è„šæœ¬
"""
import sqlite3
import shutil
from datetime import datetime
from pathlib import Path

DB_PATH = Path("data/crypto_data.db")
BACKUP_DIR = Path("data/backups")
BACKUP_DIR.mkdir(exist_ok=True)

def backup_database():
    """å¤‡ä»½æ•°æ®åº“"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_path = BACKUP_DIR / f"crypto_data.db.backup.{timestamp}"
    
    # ä½¿ç”¨ SQLite å¤‡ä»½ API
    source = sqlite3.connect(DB_PATH)
    backup = sqlite3.connect(backup_path)
    source.backup(backup)
    backup.close()
    source.close()
    
    print(f"å¤‡ä»½å®Œæˆ: {backup_path}")
    return backup_path

if __name__ == "__main__":
    backup_database()
```

ä½¿ç”¨ï¼š

```bash
python backup_db.py
```

---

### æ–¹æ³•4: è‡ªåŠ¨å¤‡ä»½è„šæœ¬

åˆ›å»º `backup_db.sh`:

```bash
#!/bin/bash

# æ•°æ®åº“å¤‡ä»½è„šæœ¬
DB_PATH="data/crypto_data.db"
BACKUP_DIR="data/backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/crypto_data.db.backup.$TIMESTAMP"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR"

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$DB_PATH" ]; then
    echo "é”™è¯¯: æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨: $DB_PATH"
    exit 1
fi

# å¤‡ä»½æ•°æ®åº“
if command -v sqlite3 &> /dev/null; then
    # ä½¿ç”¨ SQLite å¤‡ä»½å‘½ä»¤
    sqlite3 "$DB_PATH" ".backup '$BACKUP_FILE'"
else
    # ä½¿ç”¨ cp å‘½ä»¤
    cp "$DB_PATH" "$BACKUP_FILE"
fi

# å‹ç¼©å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
if command -v gzip &> /dev/null; then
    gzip "$BACKUP_FILE"
    BACKUP_FILE="${BACKUP_FILE}.gz"
fi

echo "å¤‡ä»½å®Œæˆ: $BACKUP_FILE"

# åˆ é™¤ 7 å¤©å‰çš„å¤‡ä»½ï¼ˆå¯é€‰ï¼‰
find "$BACKUP_DIR" -name "crypto_data.db.backup.*" -mtime +7 -delete

echo "æ¸…ç†å®Œæˆ: å·²åˆ é™¤ 7 å¤©å‰çš„å¤‡ä»½"
```

ä½¿ç”¨ï¼š

```bash
chmod +x backup_db.sh
./backup_db.sh
```

---

## è¿ç§»æ•°æ®åº“

### åœºæ™¯1: ä»æœ¬åœ°è¿ç§»åˆ°æœåŠ¡å™¨

```bash
# 1. åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
ssh username@server-ip "mkdir -p /opt/corniche/data"

# 2. ä¸Šä¼ æ•°æ®åº“æ–‡ä»¶
scp data/crypto_data.db username@server-ip:/opt/corniche/data/

# 3. è®¾ç½®æƒé™
ssh username@server-ip "chmod 644 /opt/corniche/data/crypto_data.db && chown $USER:$USER /opt/corniche/data/crypto_data.db"

# 4. éªŒè¯æ–‡ä»¶
ssh username@server-ip "ls -lh /opt/corniche/data/crypto_data.db"
```

---

### åœºæ™¯2: ä»æœåŠ¡å™¨è¿ç§»åˆ°æœ¬åœ°

```bash
# ä»æœåŠ¡å™¨ä¸‹è½½åˆ°æœ¬åœ°
scp username@server-ip:/opt/corniche/data/crypto_data.db data/

# æˆ–ä½¿ç”¨å¯†é’¥æ–‡ä»¶
scp -i /path/to/key.pem username@server-ip:/opt/corniche/data/crypto_data.db data/
```

---

### åœºæ™¯3: æœåŠ¡å™¨é—´è¿ç§»

```bash
# æ–¹æ³•1: é€šè¿‡æœ¬åœ°ä¸­è½¬
scp user1@server1:/opt/corniche/data/crypto_data.db /tmp/
scp /tmp/crypto_data.db user2@server2:/opt/corniche/data/

# æ–¹æ³•2: ç›´æ¥ä»æœåŠ¡å™¨1åˆ°æœåŠ¡å™¨2ï¼ˆéœ€è¦é…ç½®SSHå¯†é’¥ï¼‰
ssh user1@server1 "cat /opt/corniche/data/crypto_data.db" | \
  ssh user2@server2 "cat > /opt/corniche/data/crypto_data.db"
```

---

### åœºæ™¯4: Docker å®¹å™¨é—´è¿ç§»

```bash
# 1. ä»å®¹å™¨å¯¼å‡º
docker cp container_name:/app/data/crypto_data.db /tmp/crypto_data.db

# 2. å¯¼å…¥åˆ°å¦ä¸€ä¸ªå®¹å™¨
docker cp /tmp/crypto_data.db another_container:/app/data/crypto_data.db

# 3. æˆ–é€šè¿‡ä¸»æœºä¸­è½¬
docker cp container1:/app/data/crypto_data.db ./data/
docker cp ./data/crypto_data.db container2:/app/data/
```

---

## åŒæ­¥æ•°æ®åº“

### æ–¹æ³•1: æ‰‹åŠ¨åŒæ­¥è„šæœ¬

åˆ›å»º `sync_db.sh`:

```bash
#!/bin/bash

# æ•°æ®åº“åŒæ­¥è„šæœ¬
LOCAL_DB="data/crypto_data.db"
REMOTE_USER="username"
REMOTE_HOST="server-ip"
REMOTE_DB="/opt/corniche/data/crypto_data.db"

echo "å¼€å§‹åŒæ­¥æ•°æ®åº“..."

# 1. å¤‡ä»½è¿œç¨‹æ•°æ®åº“
echo "å¤‡ä»½è¿œç¨‹æ•°æ®åº“..."
ssh $REMOTE_USER@$REMOTE_HOST "cp $REMOTE_DB ${REMOTE_DB}.backup.$(date +%Y%m%d_%H%M%S)"

# 2. ä¸Šä¼ æœ¬åœ°æ•°æ®åº“
echo "ä¸Šä¼ æœ¬åœ°æ•°æ®åº“..."
scp $LOCAL_DB $REMOTE_USER@$REMOTE_HOST:$REMOTE_DB

# 3. è®¾ç½®æƒé™
echo "è®¾ç½®æƒé™..."
ssh $REMOTE_USER@$REMOTE_HOST "chmod 644 $REMOTE_DB"

echo "åŒæ­¥å®Œæˆï¼"
```

---

### æ–¹æ³•2: ä½¿ç”¨ rsync åŒæ­¥

```bash
# åŒæ­¥æ•°æ®åº“æ–‡ä»¶ï¼ˆæœ¬åœ° -> æœåŠ¡å™¨ï¼‰
rsync -avz --progress data/crypto_data.db username@server-ip:/opt/corniche/data/

# åŒæ­¥æ•´ä¸ª data ç›®å½•
rsync -avz --progress data/ username@server-ip:/opt/corniche/data/
```

---

### æ–¹æ³•3: åŒå‘åŒæ­¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

```bash
#!/bin/bash

# åŒå‘åŒæ­¥è„šæœ¬ï¼ˆæ¯”è¾ƒæ—¶é—´æˆ³ï¼ŒåŒæ­¥è¾ƒæ–°çš„æ–‡ä»¶ï¼‰
LOCAL_DB="data/crypto_data.db"
REMOTE_DB="username@server-ip:/opt/corniche/data/crypto_data.db"

# è·å–æœ¬åœ°æ–‡ä»¶æ—¶é—´
LOCAL_TIME=$(stat -f %m "$LOCAL_DB" 2>/dev/null || stat -c %Y "$LOCAL_DB" 2>/dev/null)

# è·å–è¿œç¨‹æ–‡ä»¶æ—¶é—´
REMOTE_TIME=$(ssh username@server-ip "stat -c %Y /opt/corniche/data/crypto_data.db" 2>/dev/null)

if [ -z "$REMOTE_TIME" ] || [ "$LOCAL_TIME" -gt "$REMOTE_TIME" ]; then
    echo "æœ¬åœ°æ–‡ä»¶è¾ƒæ–°ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨..."
    scp "$LOCAL_DB" "$REMOTE_DB"
elif [ "$REMOTE_TIME" -gt "$LOCAL_TIME" ]; then
    echo "è¿œç¨‹æ–‡ä»¶è¾ƒæ–°ï¼Œä¸‹è½½åˆ°æœ¬åœ°..."
    scp "$REMOTE_DB" "$LOCAL_DB"
else
    echo "æ–‡ä»¶å·²åŒæ­¥"
fi
```

---

## å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“æ–‡ä»¶å¾ˆå¤§ï¼Œä¸Šä¼ å¾ˆæ…¢

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. å‹ç¼©åä¸Šä¼ 
tar czf crypto_data.db.tar.gz data/crypto_data.db
scp crypto_data.db.tar.gz username@server-ip:/tmp/
ssh username@server-ip "cd /opt/corniche/data && tar xzf /tmp/crypto_data.db.tar.gz"

# 2. ä½¿ç”¨ rsyncï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰
rsync -avz --progress data/crypto_data.db username@server-ip:/opt/corniche/data/

# 3. ä½¿ç”¨å‹ç¼©ä¼ è¾“
rsync -avz --progress --compress data/crypto_data.db username@server-ip:/opt/corniche/data/
```

---

### Q2: ä¸Šä¼ åæ•°æ®åº“æ— æ³•è®¿é—®

**å¯èƒ½åŸå› ï¼š**
1. æƒé™é—®é¢˜
2. è·¯å¾„é”™è¯¯
3. æœåŠ¡æœªé‡å¯

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. æ£€æŸ¥æ–‡ä»¶æƒé™
ssh username@server-ip "ls -lh /opt/corniche/data/crypto_data.db"

# 2. è®¾ç½®æ­£ç¡®æƒé™
ssh username@server-ip "chmod 644 /opt/corniche/data/crypto_data.db"

# 3. æ£€æŸ¥æ–‡ä»¶æ‰€æœ‰è€…
ssh username@server-ip "chown $USER:$USER /opt/corniche/data/crypto_data.db"

# 4. é‡å¯æœåŠ¡ï¼ˆDockerï¼‰
docker-compose restart
```

---

### Q3: æ•°æ®åº“æ–‡ä»¶æŸå

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
sqlite3 data/crypto_data.db "PRAGMA integrity_check;"

# 2. å¦‚æœæŸåï¼Œå°è¯•ä¿®å¤
sqlite3 data/crypto_data.db ".recover" | sqlite3 data/crypto_data.db.recovered

# 3. ä»å¤‡ä»½æ¢å¤
cp data/backups/crypto_data.db.backup.20240101_120000 data/crypto_data.db
```

---

### Q4: Docker å®¹å™¨ä¸­æ‰¾ä¸åˆ°æ•°æ®åº“æ–‡ä»¶

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. æ£€æŸ¥ volume æŒ‚è½½
docker-compose config | grep -A 5 volumes

# 2. æ£€æŸ¥å®¹å™¨å†…çš„æ–‡ä»¶
docker exec -it container_name ls -lh /app/data/

# 3. æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec -it container_name env | grep DB_PATH

# 4. é‡æ–°æŒ‚è½½ volume
docker-compose down
docker-compose up -d
```

---

### Q5: å¦‚ä½•éªŒè¯æ•°æ®åº“æ–‡ä»¶å®Œæ•´æ€§

```bash
# 1. æ£€æŸ¥æ–‡ä»¶å¤§å°
ls -lh data/crypto_data.db

# 2. æ£€æŸ¥ SQLite æ•°æ®åº“
sqlite3 data/crypto_data.db "SELECT COUNT(*) FROM sqlite_master WHERE type='table';"

# 3. æ£€æŸ¥è¡¨ç»“æ„
sqlite3 data/crypto_data.db ".tables"

# 4. æ£€æŸ¥æ•°æ®é‡
sqlite3 data/crypto_data.db "SELECT name FROM sqlite_master WHERE type='table';" | \
  while read table; do
    echo "Table: $table"
    sqlite3 data/crypto_data.db "SELECT COUNT(*) FROM $table;"
  done
```

---

## å¿«é€Ÿå‚è€ƒ

### ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# æœ€ç®€å•çš„æ–¹å¼
scp data/crypto_data.db username@server-ip:/opt/corniche/data/

# ä½¿ç”¨å¯†é’¥æ–‡ä»¶
scp -i /path/to/key.pem data/crypto_data.db username@server-ip:/opt/corniche/data/

# ä½¿ç”¨ rsyncï¼ˆæ¨èï¼‰
rsync -avz --progress data/crypto_data.db username@server-ip:/opt/corniche/data/
```

### å¤‡ä»½æ•°æ®åº“

```bash
# ç®€å•å¤‡ä»½
cp data/crypto_data.db data/crypto_data.db.backup.$(date +%Y%m%d_%H%M%S)

# SQLite å¤‡ä»½
sqlite3 data/crypto_data.db ".backup 'data/crypto_data.db.backup.$(date +%Y%m%d_%H%M%S)'"
```

### ä¸‹è½½åˆ°æœ¬åœ°

```bash
# ä»æœåŠ¡å™¨ä¸‹è½½
scp username@server-ip:/opt/corniche/data/crypto_data.db data/
```

---

## ç›¸å…³æ–‡æ¡£

- [æ–‡ä»¶ä¸Šä¼ æŒ‡å—.md](./æ–‡ä»¶ä¸Šä¼ æŒ‡å—.md) - æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†æ–¹æ³•
- [LinuxæœåŠ¡å™¨å®‰è£…æŒ‡å—.md](./LinuxæœåŠ¡å™¨å®‰è£…æŒ‡å—.md) - æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—
- [UbuntuæœåŠ¡å™¨Gitå…‹éš†æŒ‡å—.md](./UbuntuæœåŠ¡å™¨Gitå…‹éš†æŒ‡å—.md) - Git å…‹éš†æŒ‡å—

---

## æ€»ç»“

**æœ€å¸¸ç”¨çš„æ“ä½œï¼š**

1. **ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š**
   ```bash
   scp data/crypto_data.db username@server-ip:/opt/corniche/data/
   ```

2. **å¤‡ä»½æ•°æ®åº“ï¼š**
   ```bash
   sqlite3 data/crypto_data.db ".backup 'data/crypto_data.db.backup.$(date +%Y%m%d_%H%M%S)'"
   ```

3. **ä¸‹è½½åˆ°æœ¬åœ°ï¼š**
   ```bash
   scp username@server-ip:/opt/corniche/data/crypto_data.db data/
   ```
