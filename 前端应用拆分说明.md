# 前端应用拆分说明

## 概述

前端应用已拆分为两个完全独立的前端应用：

1. **数据管理前端** (`frontend-data`) - 数据服务相关功能
2. **回测交易前端** (`frontend-backtrade`) - 回测和交易相关功能

---

## 目录结构

```
corniche/
├── frontend-data/          # 数据管理前端（独立应用）
│   ├── app/
│   │   ├── page.tsx       # 主页面（数据管理 Dashboard）
│   │   ├── layout.tsx     # 布局
│   │   └── globals.css    # 全局样式
│   ├── components/         # 数据管理相关组件
│   ├── lib/               # API 配置
│   ├── contexts/          # React Context
│   ├── package.json       # 依赖配置
│   ├── Dockerfile         # Docker 配置
│   └── ...
│
├── frontend-backtrade/     # 回测交易前端（独立应用）
│   ├── app/
│   │   ├── page.tsx       # 主页面（回测交易 Dashboard）
│   │   ├── layout.tsx     # 布局
│   │   └── globals.css    # 全局样式
│   ├── components/        # 回测交易相关组件
│   ├── lib/               # API 配置
│   ├── contexts/          # React Context
│   ├── package.json       # 依赖配置
│   ├── Dockerfile         # Docker 配置
│   └── ...
│
└── frontend/              # 旧的前端（可保留或删除）
```

---

## 数据管理前端 (`frontend-data`)

### 端口
- **开发环境**: 3001
- **生产环境**: 3001

### 功能模块

1. **下载数据** - K线数据下载
2. **删除数据** - 删除K线数据
3. **修改数据** - 编辑K线数据
4. **查看K线** - 查看和对比K线数据
5. **列表与图表** - 交易对列表和图表
6. **完整性检查** - 数据完整性校验
7. **数据库文件** - 数据库文件上传和下载

### 组件

- `DownloadForm.tsx`
- `DeleteForm.tsx`
- `EditDataForm.tsx`
- `KlineViewer.tsx`
- `SymbolListWithChart.tsx`
- `DataIntegrityChecker.tsx`
- `DatabaseFileManager.tsx`
- `KlineChart.tsx`
- `SymbolList.tsx`

### 访问地址

- 开发: http://localhost:3001
- 生产: http://yourdomain.com:3001

---

## 回测交易前端 (`frontend-backtrade`)

### 端口
- **开发环境**: 3002
- **生产环境**: 3002

### 功能模块

1. **回测交易** - 标准回测和聪明钱回测
2. **合约下单** - 订单计算

### 组件

- `BacktestForm.tsx`
- `OrderCalculator.tsx`

### 访问地址

- 开发: http://localhost:3002
- 生产: http://yourdomain.com:3002

---

## 开发环境启动

### 数据管理前端

```bash
cd frontend-data
npm install
npm run dev
```

访问: http://localhost:3001

### 回测交易前端

```bash
cd frontend-backtrade
npm install
npm run dev
```

访问: http://localhost:3002

---

## Docker 部署

### 使用 Docker Compose

```bash
# 构建并启动所有服务（包括两个前端）
docker-compose up -d --build

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f frontend-data
docker-compose logs -f frontend-backtrade
```

### 单独构建前端

```bash
# 构建数据管理前端
cd frontend-data
docker build -t frontend-data .

# 构建回测交易前端
cd frontend-backtrade
docker build -t frontend-backtrade .
```

---

## Nginx 配置

### 方案1: 使用不同端口

```nginx
# 数据管理前端
server {
    listen 80;
    server_name data.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:3001;
        # ... 其他配置
    }
}

# 回测交易前端
server {
    listen 80;
    server_name backtrade.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:3002;
        # ... 其他配置
    }
}
```

### 方案2: 使用路径

```nginx
server {
    listen 80;
    server_name yourdomain.com;
    
    # 数据管理前端
    location /data/ {
        proxy_pass http://localhost:3001/;
    }
    
    # 回测交易前端
    location /backtrade/ {
        proxy_pass http://localhost:3002/;
    }
}
```

---

## 环境变量配置

### 数据管理前端

创建 `frontend-data/.env.local`:

```bash
NEXT_PUBLIC_DATA_SERVICE_URL=http://localhost:8001
NEXT_PUBLIC_BACKTEST_SERVICE_URL=http://localhost:8002
NEXT_PUBLIC_ORDER_SERVICE_URL=http://localhost:8003
```

### 回测交易前端

创建 `frontend-backtrade/.env.local`:

```bash
NEXT_PUBLIC_DATA_SERVICE_URL=http://localhost:8001
NEXT_PUBLIC_BACKTEST_SERVICE_URL=http://localhost:8002
NEXT_PUBLIC_ORDER_SERVICE_URL=http://localhost:8003
```

---

## 优势

### 1. 完全独立

- ✅ 两个应用完全独立，互不影响
- ✅ 可以独立部署和更新
- ✅ 可以独立扩展和优化

### 2. 清晰的职责分离

- ✅ 数据管理前端专注于数据操作
- ✅ 回测交易前端专注于交易策略

### 3. 更好的性能

- ✅ 每个应用体积更小
- ✅ 加载速度更快
- ✅ 可以独立优化

### 4. 灵活的部署

- ✅ 可以部署到不同的服务器
- ✅ 可以使用不同的域名
- ✅ 可以独立扩展

---

## 迁移步骤

### 1. 安装依赖

```bash
# 数据管理前端
cd frontend-data
npm install

# 回测交易前端
cd frontend-backtrade
npm install
```

### 2. 测试运行

```bash
# 终端1: 启动数据管理前端
cd frontend-data
npm run dev

# 终端2: 启动回测交易前端
cd frontend-backtrade
npm run dev
```

### 3. 更新 Docker Compose

```bash
# 停止旧的前端
docker-compose stop frontend

# 启动新的前端
docker-compose up -d frontend-data frontend-backtrade
```

---

## 注意事项

1. **端口冲突**: 确保 3001 和 3002 端口未被占用
2. **环境变量**: 两个前端需要配置相同的后端服务地址
3. **共享组件**: 如果需要共享组件，可以创建共享库或分别维护
4. **旧前端**: `frontend/` 目录可以保留作为备份，或删除

---

## 总结

✅ **已完成：**
- 创建两个独立的前端应用
- 配置独立的端口和 Docker
- 更新 Docker Compose 配置
- 创建完整的文档

✅ **优势：**
- 完全独立，互不干扰
- 职责清晰，易于维护
- 性能更好，体积更小
- 部署灵活，可独立扩展
