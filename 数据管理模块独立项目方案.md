# æ•°æ®ç®¡ç†æ¨¡å—ç‹¬ç«‹é¡¹ç›®æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

å°†æ•°æ®ç®¡ç†æ¨¡å—ä»å½“å‰é¡¹ç›®ä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œåˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„é¡¹ç›®ï¼ŒåŒ…å«åç«¯æœåŠ¡ã€å‰ç«¯åº”ç”¨å’Œæ•°æ®åº“ç®¡ç†å·¥å…·ã€‚

## ğŸ¯ é¡¹ç›®ç»“æ„

```
crypto-data-manager/                    # æ–°é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ README.md                          # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ .env.example                       # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                         # Gitå¿½ç•¥æ–‡ä»¶
â”‚
â”œâ”€â”€ backend/                           # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                        # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                      # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ db.py                          # æ•°æ®åº“è¿æ¥å’ŒåŸºç¡€æ“ä½œ
â”‚   â”œâ”€â”€ data.py                        # æ•°æ®æŸ¥è¯¢å’Œå¤„ç†
â”‚   â”œâ”€â”€ download_klines.py             # Kçº¿æ•°æ®ä¸‹è½½
â”‚   â”œâ”€â”€ binance_api.py                 # å¸å®‰APIå°è£…
â”‚   â”œâ”€â”€ migrate.py                     # æ•°æ®åº“è¿ç§»å·¥å…·ï¼ˆSQLite â†’ PostgreSQLï¼‰
â”‚   â”œâ”€â”€ requirements.txt               # Pythonä¾èµ–
â”‚   â”œâ”€â”€ Dockerfile                     # Dockeré•œåƒ
â”‚   â””â”€â”€ docker-compose.yml             # Docker Composeé…ç½®
â”‚
â”œâ”€â”€ frontend/                           # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ app/                           # Next.jsåº”ç”¨ç›®å½•
â”‚   â”‚   â”œâ”€â”€ page.tsx                   # ä¸»é¡µé¢
â”‚   â”‚   â”œâ”€â”€ layout.tsx                 # å¸ƒå±€
â”‚   â”‚   â””â”€â”€ globals.css                # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ components/                    # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DownloadForm.tsx           # ä¸‹è½½è¡¨å•
â”‚   â”‚   â”œâ”€â”€ DeleteForm.tsx             # åˆ é™¤è¡¨å•
â”‚   â”‚   â”œâ”€â”€ EditDataForm.tsx           # ç¼–è¾‘è¡¨å•
â”‚   â”‚   â”œâ”€â”€ KlineViewer.tsx            # Kçº¿æŸ¥çœ‹å™¨
â”‚   â”‚   â”œâ”€â”€ SymbolListWithChart.tsx    # äº¤æ˜“å¯¹åˆ—è¡¨å’Œå›¾è¡¨
â”‚   â”‚   â”œâ”€â”€ DataIntegrityChecker.tsx    # æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
â”‚   â”‚   â””â”€â”€ DatabaseFileManager.tsx     # æ•°æ®åº“æ–‡ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ contexts/                      # React Context
â”‚   â”œâ”€â”€ lib/                           # å·¥å…·åº“
â”‚   â”‚   â””â”€â”€ api-config.ts              # APIé…ç½®
â”‚   â”œâ”€â”€ package.json                   # Node.jsä¾èµ–
â”‚   â”œâ”€â”€ Dockerfile                     # Dockeré•œåƒ
â”‚   â””â”€â”€ next.config.ts                 # Next.jsé…ç½®
â”‚
â”œâ”€â”€ data/                              # æ•°æ®ç›®å½•ï¼ˆå¯é€‰ï¼Œç”¨äºæœ¬åœ°å¼€å‘ï¼‰
â”‚   â””â”€â”€ crypto_data.db                 # SQLiteæ•°æ®åº“æ–‡ä»¶
â”‚
â”œâ”€â”€ scripts/                           # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ init_db.py                     # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ migrate.sh                     # è¿ç§»è„šæœ¬
â”‚
â””â”€â”€ docs/                              # æ–‡æ¡£ç›®å½•
    â”œâ”€â”€ API.md                         # APIæ–‡æ¡£
    â”œâ”€â”€ DEPLOYMENT.md                  # éƒ¨ç½²æ–‡æ¡£
    â””â”€â”€ DEVELOPMENT.md                 # å¼€å‘æ–‡æ¡£
```

## ğŸ“¦ éœ€è¦è¿ç§»çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶

1. **æ ¸å¿ƒæœåŠ¡æ–‡ä»¶**
   - `backend/services/data_service/main.py` â†’ `backend/main.py`
   - `backend/db.py` â†’ `backend/db.py`
   - `backend/data.py` â†’ `backend/data.py`
   - `backend/download_klines.py` â†’ `backend/download_klines.py`
   - `backend/binance_api.py` â†’ `backend/binance_api.py`
   - `backend/migrate.py` â†’ `backend/migrate.py`

2. **é…ç½®æ–‡ä»¶**
   - åˆ›å»º `backend/config.py`ï¼ˆæ•´åˆå…±äº«é…ç½®ï¼‰

### å‰ç«¯æ–‡ä»¶

1. **åº”ç”¨æ–‡ä»¶**
   - `frontend-data/app/` â†’ `frontend/app/`
   - `frontend-data/components/` â†’ `frontend/components/`
   - `frontend-data/contexts/` â†’ `frontend/contexts/`
   - `frontend-data/lib/` â†’ `frontend/lib/`
   - `frontend-data/package.json` â†’ `frontend/package.json`
   - `frontend-data/next.config.ts` â†’ `frontend/next.config.ts`

## ğŸ”§ éœ€è¦ä¿®æ”¹çš„å†…å®¹

### 1. åç«¯é…ç½® (`backend/config.py`)

```python
"""
æ•°æ®ç®¡ç†æœåŠ¡é…ç½®
"""
import os
from pathlib import Path
from dotenv import load_dotenv

# åŠ è½½ .env æ–‡ä»¶
backend_dir = Path(__file__).parent
project_root = backend_dir.parent
env_path = project_root / '.env'
if env_path.exists():
    load_dotenv(dotenv_path=env_path)

# æ•°æ®åº“é…ç½®
DB_PATH = os.getenv("DB_PATH", str(project_root / "data" / "crypto_data.db"))

# æœåŠ¡é…ç½®
SERVICE_PORT = int(os.getenv("DATA_SERVICE_PORT", "8001"))
SERVICE_HOST = os.getenv("DATA_SERVICE_HOST", "0.0.0.0")

# CORSé…ç½®
ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:3001",
    "http://127.0.0.1:3001",
    # æ·»åŠ ç”Ÿäº§ç¯å¢ƒåŸŸå
]

# å¸å®‰APIé…ç½®
BINANCE_API_KEY = os.getenv("BINANCE_API_KEY", "")
BINANCE_API_SECRET = os.getenv("BINANCE_API_SECRET", "")
BINANCE_BASE_PATH = os.getenv("BINANCE_BASE_PATH", "")

# PostgreSQLé…ç½®ï¼ˆç”¨äºè¿ç§»ï¼‰
PG_HOST = os.getenv("PG_HOST", "localhost")
PG_PORT = int(os.getenv("PG_PORT", "5432"))
PG_DB = os.getenv("PG_DB", "crypto_data")
PG_USER = os.getenv("PG_USER", "postgres")
PG_PASSWORD = os.getenv("PG_PASSWORD", "")
```

### 2. ä¿®æ”¹å¯¼å…¥è·¯å¾„

#### `backend/main.py`
```python
# ä¿®æ”¹å‰
from services.shared.config import DATA_SERVICE_PORT, ALLOWED_ORIGINS

# ä¿®æ”¹å
from config import SERVICE_PORT as DATA_SERVICE_PORT, ALLOWED_ORIGINS
```

#### `backend/db.py`
```python
# ä¿®æ”¹å‰
backend_dir = Path(__file__).parent
project_root = backend_dir.parent
db_path = str(project_root / "data" / "crypto_data.db")

# ä¿®æ”¹å
from config import DB_PATH as db_path
```

#### `backend/binance_api.py`
```python
# ä¿®æ”¹å‰
backend_dir = Path(__file__).parent
project_root = backend_dir.parent

# ä¿®æ”¹å
from config import BINANCE_API_KEY, BINANCE_API_SECRET, BINANCE_BASE_PATH
```

### 3. å‰ç«¯APIé…ç½® (`frontend/lib/api-config.ts`)

```typescript
// ä¿®æ”¹APIåŸºç¡€URL
export const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8001';

// æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡
export const API_BASE_URL = 
  process.env.NEXT_PUBLIC_API_URL || 
  (typeof window !== 'undefined' 
    ? `${window.location.protocol}//${window.location.hostname}:8001`
    : 'http://localhost:8001');
```

### 4. ä¾èµ–æ–‡ä»¶

#### `backend/requirements.txt`
```txt
fastapi==0.115.0
uvicorn[standard]==0.32.0
pandas==2.2.3
numpy==2.1.3
sqlalchemy==2.0.36
pydantic==2.10.3
python-binance==1.0.19
binance-sdk-derivatives-trading-usds-futures
python-dotenv==1.0.0
psycopg2-binary==2.9.9
httpx==0.27.0
```

#### `frontend/package.json`
```json
{
  "name": "crypto-data-manager-frontend",
  "version": "1.0.0",
  "scripts": {
    "dev": "next dev -p 3001",
    "build": "next build",
    "start": "next start -p 3001"
  },
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0"
  }
}
```

## ğŸš€ å®æ–½æ­¥éª¤

### æ­¥éª¤1: åˆ›å»ºæ–°é¡¹ç›®ç›®å½•ç»“æ„

```bash
# åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•
mkdir crypto-data-manager
cd crypto-data-manager

# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p backend frontend/app frontend/components frontend/contexts frontend/lib
mkdir -p data scripts docs
```

### æ­¥éª¤2: è¿ç§»åç«¯æ–‡ä»¶

```bash
# ä»åŸé¡¹ç›®å¤åˆ¶æ–‡ä»¶
cp -r /path/to/corniche/backend/services/data_service/main.py backend/main.py
cp /path/to/corniche/backend/db.py backend/
cp /path/to/corniche/backend/data.py backend/
cp /path/to/corniche/backend/download_klines.py backend/
cp /path/to/corniche/backend/binance_api.py backend/
cp /path/to/corniche/backend/migrate.py backend/
cp /path/to/corniche/backend/requirements.txt backend/
```

### æ­¥éª¤3: è¿ç§»å‰ç«¯æ–‡ä»¶

```bash
# å¤åˆ¶å‰ç«¯æ–‡ä»¶
cp -r /path/to/corniche/frontend-data/* frontend/
```

### æ­¥éª¤4: åˆ›å»ºé…ç½®æ–‡ä»¶

1. åˆ›å»º `backend/config.py`ï¼ˆå‚è€ƒä¸Šé¢çš„é…ç½®ï¼‰
2. åˆ›å»º `.env.example`
3. åˆ›å»º `README.md`
4. åˆ›å»º `Dockerfile` å’Œ `docker-compose.yml`

### æ­¥éª¤5: ä¿®æ”¹å¯¼å…¥è·¯å¾„

ä½¿ç”¨æŸ¥æ‰¾æ›¿æ¢å·¥å…·æ‰¹é‡ä¿®æ”¹ï¼š
- `from services.shared.config` â†’ `from config`
- `from download_klines` â†’ `from download_klines`ï¼ˆä¿æŒä¸å˜ï¼‰
- `from data` â†’ `from data`ï¼ˆä¿æŒä¸å˜ï¼‰
- `from binance_api` â†’ `from binance_api`ï¼ˆä¿æŒä¸å˜ï¼‰

### æ­¥éª¤6: æµ‹è¯•

```bash
# æµ‹è¯•åç«¯
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python main.py

# æµ‹è¯•å‰ç«¯
cd frontend
npm install
npm run dev
```

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½® (`.env.example`)

```env
# æ•°æ®åº“é…ç½®
DB_PATH=data/crypto_data.db

# æœåŠ¡é…ç½®
DATA_SERVICE_PORT=8001
DATA_SERVICE_HOST=0.0.0.0

# å¸å®‰APIé…ç½®
BINANCE_API_KEY=your_api_key_here
BINANCE_API_SECRET=your_api_secret_here
BINANCE_BASE_PATH=https://fapi.binance.com

# PostgreSQLé…ç½®ï¼ˆç”¨äºè¿ç§»ï¼‰
PG_HOST=localhost
PG_PORT=5432
PG_DB=crypto_data
PG_USER=postgres
PG_PASSWORD=your_password

# å‰ç«¯é…ç½®
NEXT_PUBLIC_API_URL=http://localhost:8001
```

## ğŸ³ Dockeré…ç½®

### `backend/Dockerfile`
```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8001

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]
```

### `frontend/Dockerfile`
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

RUN npm run build

EXPOSE 3001

CMD ["npm", "start"]
```

### `docker-compose.yml`
```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8001:8001"
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env
    environment:
      - DB_PATH=/app/data/crypto_data.db

  frontend:
    build: ./frontend
    ports:
      - "3001:3001"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8001
    depends_on:
      - backend
```

## ğŸ“š æ–‡æ¡£

### `README.md`
```markdown
# åŠ å¯†è´§å¸æ•°æ®ç®¡ç†ç³»ç»Ÿ

## åŠŸèƒ½ç‰¹æ€§

- Kçº¿æ•°æ®ä¸‹è½½å’Œç®¡ç†
- æ•°æ®æŸ¥è¯¢å’Œæ£€ç´¢
- æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
- æ•°æ®ä¿®å¤å’Œé‡æ£€
- æ•°æ®åº“è¿ç§»ï¼ˆSQLite â†’ PostgreSQLï¼‰

## å¿«é€Ÿå¼€å§‹

### åç«¯
```bash
cd backend
pip install -r requirements.txt
python main.py
```

### å‰ç«¯
```bash
cd frontend
npm install
npm run dev
```

## APIæ–‡æ¡£

å¯åŠ¨åç«¯æœåŠ¡åï¼Œè®¿é—® http://localhost:8001/docs æŸ¥çœ‹APIæ–‡æ¡£ã€‚
```

## âœ… æ£€æŸ¥æ¸…å•

- [ ] åˆ›å»ºæ–°é¡¹ç›®ç›®å½•ç»“æ„
- [ ] è¿ç§»åç«¯æ–‡ä»¶
- [ ] è¿ç§»å‰ç«¯æ–‡ä»¶
- [ ] åˆ›å»ºé…ç½®æ–‡ä»¶
- [ ] ä¿®æ”¹å¯¼å…¥è·¯å¾„
- [ ] æ›´æ–°ç¯å¢ƒå˜é‡
- [ ] åˆ›å»ºDockeré…ç½®
- [ ] ç¼–å†™æ–‡æ¡£
- [ ] æµ‹è¯•åç«¯æœåŠ¡
- [ ] æµ‹è¯•å‰ç«¯åº”ç”¨
- [ ] æµ‹è¯•æ•°æ®åº“è¿ç§»
- [ ] æµ‹è¯•æ•°æ®ä¸‹è½½åŠŸèƒ½
- [ ] æµ‹è¯•æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

## ğŸ”„ ä¸åŸé¡¹ç›®çš„é›†æˆ

å¦‚æœéœ€è¦åœ¨åŸé¡¹ç›®ä¸­ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®ç®¡ç†æœåŠ¡ï¼š

1. **é€šè¿‡APIè°ƒç”¨**ï¼šåŸé¡¹ç›®é€šè¿‡HTTP APIè°ƒç”¨æ•°æ®ç®¡ç†æœåŠ¡
2. **å…±äº«æ•°æ®åº“**ï¼šå¯ä»¥å…±äº«åŒä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼ˆé€šè¿‡ç½‘ç»œæŒ‚è½½æˆ–APIï¼‰
3. **ç‹¬ç«‹éƒ¨ç½²**ï¼šæ•°æ®ç®¡ç†æœåŠ¡å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£æˆ–æäº¤Issueã€‚
